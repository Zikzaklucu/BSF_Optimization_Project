<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSF Profit Optimizer - PIAT UGM Model</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0fdf4; }
        .tab-active { border-bottom: 3px solid #16a34a; color: #16a34a; font-weight: bold; }
        .tab-inactive { color: #6b7280; }
    </style>
</head>
<body class="text-gray-800 relative">

    <!-- Navbar -->
    <nav class="bg-green-700 text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fas fa-bug text-2xl"></i>
                <div>
                    <h1 class="text-xl font-bold hidden md:block">BSF Profit Optimizer</h1>
                    <h1 class="text-xl font-bold md:hidden">BSF Optimizer</h1>
                    <p class="text-xs text-green-200">PIAT UGM Project Model</p>
                </div>
            </div>
            
            <!-- TOMBOL LINK KE GOOGLE COLAB -->
            <div>
                <a href="https://colab.research.google.com/drive/1FW3X1tMOPpLh3j6GwT-jgSx7Q0rUM_An?usp=sharing" 
                   target="_blank" 
                   class="bg-gray-900 hover:bg-black text-white px-4 py-2 rounded-lg text-sm font-semibold transition shadow border border-gray-600 flex items-center decoration-none">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/d/d0/Google_Colaboratory_SVG_Logo.svg" class="w-5 h-5 mr-2" alt="Colab Logo">
                    Buka Source Code
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container mx-auto mt-6 p-4 max-w-5xl">
        
        <!-- Tabs Menu -->
        <div class="flex border-b border-gray-300 mb-6 bg-white rounded-t-lg shadow-sm">
            <button onclick="switchTab('calculator')" id="tab-calc" class="w-1/2 py-4 text-center tab-active transition hover:bg-gray-50">
                <i class="fas fa-calculator mr-2"></i> Kalkulator
            </button>
            <button onclick="switchTab('reference')" id="tab-ref" class="w-1/2 py-4 text-center tab-inactive transition hover:bg-gray-50">
                <i class="fas fa-book mr-2"></i> Referensi Riset
            </button>
        </div>

        <!-- SECTION 1: CALCULATOR -->
        <div id="section-calculator" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Input Column -->
            <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md h-fit">
                <h2 class="text-lg font-bold mb-4 text-green-800 border-b pb-2">1. Input Variabel</h2>
                
                <!-- Mode Toggle -->
                <div class="flex bg-gray-100 p-1 rounded-lg mb-4">
                    <button onclick="setMode('simple')" id="btn-simple" class="w-1/2 py-1 rounded-md text-sm font-medium bg-white shadow text-green-700">Mode Simpel</button>
                    <button onclick="setMode('advanced')" id="btn-advanced" class="w-1/2 py-1 rounded-md text-sm font-medium text-gray-500 hover:text-green-700">Advanced</button>
                </div>

                <form id="optimizerForm" onsubmit="event.preventDefault(); calculate();">
                    <div id="inputs-container"></div>
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg mt-4 transition shadow-lg transform hover:scale-105">
                        <i class="fas fa-rocket mr-2"></i> Hitung Optimasi
                    </button>
                </form>
            </div>

            <!-- Result Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Top Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gradient-to-br from-green-600 to-green-500 text-white p-5 rounded-lg shadow-lg">
                        <div class="text-green-100 text-sm font-semibold uppercase">Profit Maksimal</div>
                        <div class="text-2xl font-bold mt-1" id="res-profit">Rp 0</div>
                        <div class="text-xs mt-2 opacity-80"><i class="fas fa-coins"></i> per siklus</div>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-md border-l-4 border-blue-500">
                        <div class="text-gray-500 text-sm font-semibold uppercase">Jual Segar</div>
                        <div class="text-2xl font-bold text-gray-800 mt-1" id="res-fresh">0 kg</div>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-md border-l-4 border-orange-500">
                        <div class="text-gray-500 text-sm font-semibold uppercase">Jual Kering</div>
                        <div class="text-2xl font-bold text-gray-800 mt-1" id="res-dry">0 kg</div>
                    </div>
                </div>

                <!-- Charts & Details -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="text-gray-700 font-bold mb-2 text-center text-sm">Distribusi Keuangan</h3>
                        <div class="relative h-48 w-full"><canvas id="profitChart"></canvas></div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-sm">
                        <h3 class="text-gray-700 font-bold mb-3 border-b pb-2">Metrik Operasional</h3>
                        <ul class="space-y-3">
                            <li class="flex justify-between"><span class="text-gray-600">Sampah Terolah:</span><span class="font-bold text-gray-800" id="res-waste">0 kg</span></li>
                            <li class="flex justify-between"><span class="text-gray-600">Total Biomassa:</span><span class="font-bold text-gray-800" id="res-biomass">0 kg</span></li>
                            <li class="flex justify-between"><span class="text-gray-600">Utilisasi Fasilitas:</span><span class="font-bold text-gray-800" id="res-utilization">0%</span></li>
                            <li class="flex justify-between"><span class="text-gray-600">Est. Biaya Listrik:</span><span class="font-bold text-red-600" id="res-electricity">Rp 0</span></li>
                        </ul>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 text-sm text-blue-800">
                    <strong class="block mb-1"><i class="fas fa-lightbulb"></i> Analisis Strategi:</strong>
                    <p id="strategy-text">Masukkan data untuk melihat rekomendasi AI.</p>
                </div>
            </div>
        </div>

        <!-- SECTION 2: REFERENCES -->
        <div id="section-reference" class="hidden bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-green-800 mb-6 border-b pb-4">Dasar Teori & Referensi</h2>
            <div class="space-y-6">
                <div class="flex gap-4 items-start">
                    <i class="fas fa-flask text-green-600 text-2xl mt-1"></i>
                    <div>
                        <h3 class="font-bold text-lg">1. Bioconversion Rate (20%)</h3>
                        <p class="text-gray-600 italic">"Black Soldier Fly Biowaste Processing - A Step-by-Step Guide", Eawag (2017).</p>
                    </div>
                </div>
                <div class="flex gap-4 items-start">
                    <i class="fas fa-sun text-orange-500 text-2xl mt-1"></i>
                    <div>
                        <h3 class="font-bold text-lg">2. Rasio Pengeringan (4:1)</h3>
                        <p class="text-gray-600 italic">"State-of-the-art on use of insects as animal feed", Makkar et al (2014).</p>
                    </div>
                </div>
                <div class="mt-8 bg-gray-100 p-4 rounded text-sm text-gray-600">
                    <strong>Catatan Akademis:</strong> Aplikasi ini menggunakan pendekatan <em>Deterministic Linear Programming</em>. Logika optimasi di website ini adalah porting langsung dari algoritma Python yang dapat dilihat pada menu "Buka Source Code".
                </div>
            </div>
        </div>

    </div>

    <!-- FOOTER -->
    <footer class="text-center py-6 text-gray-500 text-sm mt-8">
        <p>&copy; 2024 PIAT UGM Project Model.</p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. DEFAULTS ---
        const DEFAULTS = { bcr: 0.20, drying_ratio: 4.0, energy: 2.5, electricity: 1444.70, dryer_cap_simple: 100000 };
        let currentMode = 'simple';
        let myChart = null;

        // --- 2. INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => { renderInputs(); calculate(); });

        // --- 3. TABS & MODE ---
        function switchTab(tabName) {
            document.getElementById('section-calculator').classList.toggle('hidden', tabName !== 'calculator');
            document.getElementById('section-reference').classList.toggle('hidden', tabName !== 'reference');
            document.getElementById('tab-calc').className = tabName === 'calculator' ? "w-1/2 py-4 text-center tab-active hover:bg-gray-50" : "w-1/2 py-4 text-center tab-inactive hover:bg-gray-50";
            document.getElementById('tab-ref').className = tabName === 'reference' ? "w-1/2 py-4 text-center tab-active hover:bg-gray-50" : "w-1/2 py-4 text-center tab-inactive hover:bg-gray-50";
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-simple').className = mode === 'simple' ? "w-1/2 py-1 rounded-md text-sm font-medium bg-white shadow text-green-700" : "w-1/2 py-1 rounded-md text-sm font-medium text-gray-500 hover:text-green-700";
            document.getElementById('btn-advanced').className = mode === 'advanced' ? "w-1/2 py-1 rounded-md text-sm font-medium bg-white shadow text-green-700" : "w-1/2 py-1 rounded-md text-sm font-medium text-gray-500 hover:text-green-700";
            renderInputs();
        }

        function renderInputs() {
            const container = document.getElementById('inputs-container');
            let html = '';
            html += createInput('waste', 'Sampah Tersedia (kg)', 1000);
            html += createInput('capacity', 'Kapasitas Maggot Basah (kg)', 300);
            html += createInput('price_fresh', 'Harga Jual Segar (Rp/kg)', 6000);
            html += createInput('price_dry', 'Harga Jual Kering (Rp/kg)', 45000);
            html += createInput('cost_ops', 'Biaya Ops / kg Sampah (Rp)', 500);

            if (currentMode === 'advanced') {
                html += `<div class="border-t pt-4 mt-4"><h3 class="font-bold text-xs text-gray-500 uppercase mb-2">Parameter Teknis</h3>`;
                html += createInput('bcr', 'Bioconversion Rate (Desimal)', DEFAULTS.bcr);
                html += createInput('ratio', 'Rasio Pengeringan', DEFAULTS.drying_ratio);
                html += createInput('energy', 'Energi Pengering (kWh/kg)', DEFAULTS.energy);
                html += createInput('elec_price', 'Tarif Listrik (Rp/kWh)', DEFAULTS.electricity);
                html += createInput('dryer_cap', 'Kapasitas Mesin (kg)', 500);
                html += `</div>`;
            }
            container.innerHTML = html;
        }

        function createInput(id, label, defaultVal) {
            return `<div class="input-group mb-3"><label class="block text-xs font-bold text-gray-600 mb-1">${label}</label><input type="number" id="in_${id}" value="${defaultVal}" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500" step="any" required></div>`;
        }

        // --- 4. CALCULATION LOGIC ---
        function calculate() {
            const waste = parseFloat(document.getElementById('in_waste').value) || 0;
            const facilityCap = parseFloat(document.getElementById('in_capacity').value) || 0;
            const priceFresh = parseFloat(document.getElementById('in_price_fresh').value) || 0;
            const priceDry = parseFloat(document.getElementById('in_price_dry').value) || 0;
            const costOpsPerKg = parseFloat(document.getElementById('in_cost_ops').value) || 0;

            let bcr = DEFAULTS.bcr, ratio = DEFAULTS.drying_ratio, energy = DEFAULTS.energy, elecPrice = DEFAULTS.electricity, dryerCap = DEFAULTS.dryer_cap_simple;

            if (currentMode === 'advanced') {
                bcr = parseFloat(document.getElementById('in_bcr').value) || 0.2;
                ratio = parseFloat(document.getElementById('in_ratio').value) || 4;
                energy = parseFloat(document.getElementById('in_energy').value) || 2.5;
                elecPrice = parseFloat(document.getElementById('in_elec_price').value) || 1444;
                dryerCap = parseFloat(document.getElementById('in_dryer_cap').value) || 1000;
            }

            const maxBiomassFromWaste = waste * bcr;
            const globalBiomassLimit = Math.min(maxBiomassFromWaste, facilityCap);

            // Optimization Logic (Corner Point)
            const profitA = calculateProfit(globalBiomassLimit, 0, priceFresh, priceDry, costOpsPerKg, energy, elecPrice, ratio, bcr);
            
            const maxDryPossible = Math.min(dryerCap, globalBiomassLimit / ratio);
            const profitB = calculateProfit(globalBiomassLimit - (maxDryPossible * ratio), maxDryPossible, priceFresh, priceDry, costOpsPerKg, energy, elecPrice, ratio, bcr);

            let bestFresh, bestDry, maxProfit;
            if (profitA >= profitB) { bestFresh = globalBiomassLimit; bestDry = 0; maxProfit = profitA; }
            else { bestDry = maxDryPossible; bestFresh = globalBiomassLimit - (bestDry * ratio); maxProfit = profitB; }

            const totalBiomass = bestFresh + (bestDry * ratio);
            const totalWasteUsed = totalBiomass / bcr;
            const electricityCost = bestDry * energy * elecPrice;
            const opsCost = totalWasteUsed * costOpsPerKg;

            document.getElementById('res-profit').innerText = formatRupiah(maxProfit);
            document.getElementById('res-fresh').innerText = bestFresh.toFixed(2) + " kg";
            document.getElementById('res-dry').innerText = bestDry.toFixed(2) + " kg";
            document.getElementById('res-waste').innerText = totalWasteUsed.toFixed(2) + " kg";
            document.getElementById('res-biomass').innerText = totalBiomass.toFixed(2) + " kg";
            document.getElementById('res-utilization').innerText = ((totalBiomass/facilityCap)*100).toFixed(1) + "%";
            document.getElementById('res-electricity').innerText = formatRupiah(electricityCost);

            const strategyEl = document.getElementById('strategy-text');
            if (bestDry > 0 && bestFresh > 0) strategyEl.innerHTML = `Strategi Campuran: Optimalkan pengering (${bestDry.toFixed(1)}kg), sisanya jual segar.`;
            else if (bestDry > 0) strategyEl.innerHTML = `Fokus Kering: Jual kering semua karena margin tinggi menutupi biaya listrik.`;
            else strategyEl.innerHTML = `Fokus Segar: Jual segar semua lebih untung (hemat biaya listrik).`;

            updateChart(bestFresh * priceFresh, bestDry * priceDry, opsCost, electricityCost, maxProfit);
        }

        function calculateProfit(fresh, dry, pFresh, pDry, cOps, energy, cElec, ratio, bcr) {
            return ((fresh * pFresh) + (dry * pDry)) - ((fresh + dry * ratio) / bcr * cOps) - (dry * energy * cElec);
        }

        function formatRupiah(num) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num); }

        function updateChart(rFresh, rDry, cOps, cElec, net) {
            const ctx = document.getElementById('profitChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Omzet Segar', 'Omzet Kering', 'Biaya Ops', 'Listrik', 'Profit'],
                    datasets: [{ data: [rFresh, rDry, cOps, cElec, net], backgroundColor: ['#3b82f6', '#f97316', '#ef4444', '#fca5a5', '#22c55e'], borderWidth: 1 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 10, font: { size: 9 } } } } }
            });
        }
    </script>
</body>
</html>